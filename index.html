<!DOCTYPE html>
<html lang="jp">
	<head>
		<meta charset="utf-8">
		<title>サイトタイトル</title>
		<meta name="description" content="TOPページのディスクリプションです">
		<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes">
		<meta name="format-detection" content="telephone=no,email=no,address=no">
		<meta property="og:locale" content="ja_JP">
		<meta property="og:type" content="website">
		<meta property="og:url" content="サイトドメイン/">
		<meta property="og:title" content="サイトタイトル">
		<meta property="og:description" content="TOPページのディスクリプションです">
		<meta property="og:image" content="サイトタイトル/assets/images/ogp/ogp.jpg">
		<meta property="og:site_name" content="サイトタイトル">

		<link rel="shortcut icon" href="/favicon.ico">
		<link rel="apple-touch-icon" href="/apple-touch-icon.png">

		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Pixelify+Sans:wght@400;700&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
	<style>header[data-astro-cid-xbstl6g3]{width:100%;height:80px;text-align:center;background-color:#000;display:flex;align-items:center;justify-content:center}header[data-astro-cid-xbstl6g3] h1[data-astro-cid-xbstl6g3]{color:#fff}nav[data-astro-cid-xbstl6g3]{width:100%;text-align:center;position:fixed;bottom:0;left:0;background-color:#000}nav[data-astro-cid-xbstl6g3] ul[data-astro-cid-xbstl6g3]{max-width:1200px;margin:0 auto;display:flex;justify-content:left;gap:2.5rem}nav[data-astro-cid-xbstl6g3] ul[data-astro-cid-xbstl6g3] li[data-astro-cid-xbstl6g3]{padding:1rem}nav[data-astro-cid-xbstl6g3] ul[data-astro-cid-xbstl6g3] li[data-astro-cid-xbstl6g3] a[data-astro-cid-xbstl6g3]{color:#fff;font-size:1.5rem;padding:.5rem;text-decoration:none}.c-loading[data-astro-cid-52om46wh]{display:none;position:fixed;inset:0;width:100%;height:100%;background:rgb(255,255,255);align-items:center;justify-content:center;z-index:1000;transition:.5s opacity;opacity:1}.c-loading[data-astro-cid-52om46wh].is-show{display:flex}.c-loading[data-astro-cid-52om46wh].is-hide{opacity:0}.c-loading__dots[data-astro-cid-52om46wh]{display:flex}.c-loading__dot[data-astro-cid-52om46wh]{width:10px;height:10px;margin:0 5px;background-color:#333;animation:dotAnimation .6s infinite alternate}.c-loading__dot[data-astro-cid-52om46wh]:nth-child(1){animation-delay:0s}.c-loading__dot[data-astro-cid-52om46wh]:nth-child(2){animation-delay:.2s}.c-loading__dot[data-astro-cid-52om46wh]:nth-child(3){animation-delay:.4s}@keyframes dotAnimation{0%{transform:translateY(0)}to{transform:translateY(-20px)}}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.c-mask[data-astro-cid-cevwjtki]{position:absolute;width:0;height:100%;top:0;left:0;background-color:#000;animation:mask 1.25s forwards linear;display:none}@keyframes mask{0%{width:0;left:0}33%{width:100%;left:0}66%{width:100%;left:auto;right:0}to{width:0;left:auto;right:0}}*{margin:0;padding:0}body{width:100vw;height:100vh;overflow:hidden;font-family:Pixelify Sans,sans-serif}.l-inner{max-width:1200px;margin-inline:auto}.l-mask-content{position:relative;min-height:calc(100vh - 80px)}
</style><script type="module">const d=document.querySelector(".js-mask"),l=document.querySelector(".js-mask-content");barba.init({transitions:[{name:"default-transition",leave(){d.style.display="block",l.style.opacity="0",setTimeout(function(){l.style.opacity="1"},1e3),setTimeout(function(){d.style.display="none"},1600)}}]});const u=function(n){const t=document.head,m=n.next.html.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0],s=document.createElement("head");s.innerHTML=m;const a=["meta[name='description']","meta[property^='og']","style","script"].join(","),i=t.querySelectorAll(a);for(let e=0;e<i.length;e++)t.removeChild(i[e]);const c=s.querySelectorAll(a);for(let e=0;e<c.length;e++)t.appendChild(c[e])};barba.hooks.beforeEnter(n=>{u(n)});const h=Date.now(),o=document.querySelector("#loadingIndicator"),y=document.querySelector("#allContent");document.addEventListener("DOMContentLoaded",function(){const t=Date.now()-h;t<3e3?setTimeout(r,3e3-t):r()});function p(){o.classList.add("is-show")}function r(){y.style.display="block",o.classList.add("is-hide"),setTimeout(function(){o.classList.remove("is-show","is-hide")},500)}p();
</script></head>
	<body data-barba="wrapper">
		<div id="loadingIndicator" class="c-loading" data-astro-cid-52om46wh>
    <div class="c-loading__dots" data-astro-cid-52om46wh>
        <div class="c-loading__dot" data-astro-cid-52om46wh></div>
        <div class="c-loading__dot" data-astro-cid-52om46wh></div>
        <div class="c-loading__dot" data-astro-cid-52om46wh></div>
    </div>
</div>
		<div class="l-all" id="allContent" style="display: none;">
			<header data-astro-cid-xbstl6g3>
    <h1 data-astro-cid-xbstl6g3>MY Photo</h1>
</header>
			<div class="l-mask-content">
				<div class="c-mask js-mask" data-astro-cid-cevwjtki></div>
				<div class="js-mask-content">
					<main data-barba="container" data-barba-namespace="index">
						
<div id="webgl"></div>



					</main>
				</div>
			</div>
			<footer>
</footer>
		</div>
	
<script src="https://cdn.jsdelivr.net/npm/@barba/core"></script>
</body></html>


<script type="module">
    import * as THREE from './three.module.js'
    // import { OrbitControls } from '../../node_modules/three/examples/jsm/controls/OrbitControls.js'
   // DOM がパースされたことを検出するイベントで App3 クラスをインスタンス化する
    window.addEventListener('DOMContentLoaded', () => {
        const app = new App3();
        // app.load()
        // .then(() => {
            app.init();
            app.render();
        // });
    }, false);

    /**
     * three.js を効率よく扱うために自家製の制御クラスを定義
     */
    class App3 {
        /**
         * カメラ定義のための定数
         */
        static get CAMERA_PARAM() {
            return {
            fovy: 60,
            aspect: window.innerWidth / (window.innerHeight - document.querySelector('header').offsetHeight),
            near: 0.1,
            far: 100.0,
            x: 0.0,
            y: 0.0,
            z: 16.0,
            lookAt: new THREE.Vector3(0.0, 0.0, 0.0),
            };
        }

        /**
         * レンダラー定義のための定数
         */
        static get RENDERER_PARAM() {
            return {
            clearColor: 0xffffff,
            width: window.innerWidth,
            height: window.innerHeight - document.querySelector('header').offsetHeight,
            };
        }

        /**
         * ディレクショナルライト定義のための定数
         */
        static get DIRECTIONAL_LIGHT_PARAM() {
            return {
            color: 0xffffff,
            intensity: 1.0,
            x: 1.0,
            y: 1.0,
            z: 1.0,
            };
        }

        /**
         * アンビエントライト定義のための定数
         */
        static get AMBIENT_LIGHT_PARAM() {
            return {
            color: 0xffffff,
            intensity: 0.2,
            };
        }

        /**
         * コンストラクタ
         * @constructor
         */
        constructor() {
            this.renderer;         // レンダラ
            this.scene;            // シーン
            this.camera;           // カメラ
            this.directionalLight; // ディレクショナルライト
            this.ambientLight;     // アンビエントライト
            this.controls;         // オービットコントロール
            this.axesHelper;       // 軸ヘルパー
            this.plane;            // 板ポリゴン
            this.planeArray;
            this.hitMaterial;
            this.group;
            this.startMouseX = 0;
            this.endMouseX = 0;
            this.currentRotationY = 0;
            this.targetRotationY = 0;
            this.isDragging = false;

            // 再帰呼び出しのための this 固定
            this.render = this.render.bind(this);

            // リサイズイベント
            window.addEventListener('resize', () => {
                this.renderer.setSize(window.innerWidth, window.innerHeight - document.querySelector('header').offsetHeight);
                this.camera.aspect = window.innerWidth / (window.innerHeight - document.querySelector('header').offsetHeight);
                this.camera.updateProjectionMatrix();
            }, false);

            window.addEventListener('mousedown', this.handleMouseDown.bind(this));
            window.addEventListener('mousemove', this.handleMouseMove.bind(this));
            window.addEventListener('mouseup', this.handleMouseUp.bind(this));

        }

        /**
         * アセット（素材）のロードを行う Promise
         */
        load() {
            return new Promise((resolve) => {
            // 読み込むファイルのパス
            // const imgPath = '';
            // const loader = new THREE.TextureLoader();
            // loader.load(imgPath, (img) => {
            //     // あとで使えるようにプロパティに代入しておく
            //     this.img = img;
            //     resolve();
            // });
            resolve();
            });
        }

        /**
         * 初期化処理
         */
        init() {
            // レンダラー
            this.renderer = new THREE.WebGLRenderer();
            this.renderer.setClearColor(new THREE.Color(App3.RENDERER_PARAM.clearColor));
            this.renderer.setSize(App3.RENDERER_PARAM.width, App3.RENDERER_PARAM.height);
            const wrapper = document.querySelector('#webgl');
            wrapper.appendChild(this.renderer.domElement);

            // シーン
            this.scene = new THREE.Scene();

            // カメラ
            this.camera = new THREE.PerspectiveCamera(
                App3.CAMERA_PARAM.fovy,
                App3.CAMERA_PARAM.aspect,
                App3.CAMERA_PARAM.near,
                App3.CAMERA_PARAM.far,
            );

            this.camera.position.set(
                App3.CAMERA_PARAM.x,
                App3.CAMERA_PARAM.y,
                App3.CAMERA_PARAM.z,
            );
            this.camera.lookAt(App3.CAMERA_PARAM.lookAt);

            // ディレクショナルライト（平行光源）
            this.directionalLight = new THREE.DirectionalLight(
                App3.DIRECTIONAL_LIGHT_PARAM.color,
                App3.DIRECTIONAL_LIGHT_PARAM.intensity
            );
            this.directionalLight.position.set(
                App3.DIRECTIONAL_LIGHT_PARAM.x,
                App3.DIRECTIONAL_LIGHT_PARAM.y,
                App3.DIRECTIONAL_LIGHT_PARAM.z,
            );

            // アンビエントライト（環境光）
            this.ambientLight = new THREE.AmbientLight(
                App3.AMBIENT_LIGHT_PARAM.color,
                App3.AMBIENT_LIGHT_PARAM.intensity,
            );

            // コントロール
            // this.controls = new OrbitControls(this.camera, this.renderer.domElement);

            // ヘルパー
            const axesBarLength = 5.0;
            this.axesHelper = new THREE.AxesHelper(axesBarLength);

            // レンダリング結果を可視化するのに、板ポリゴンを使う @@@
            const planeGeometry = new THREE.PlaneGeometry(12.0, 9.0);
            const planeMaterial = new THREE.MeshBasicMaterial({
            color: 0x000000,
            side: THREE.DoubleSide
            });
            this.group = new THREE.Group();

            const LENGTH = 16;
            const RADIUS = 36;
            this.planeArray = [];

            for(let i = 0; i < LENGTH; i++) {
                const angle = (i / LENGTH) * Math.PI * 2; // 角度を計算

                const x = RADIUS * Math.sin(angle);
                const z = RADIUS * Math.cos(angle);
                const plane = new THREE.Mesh(planeGeometry, planeMaterial);
                plane.position.set( x, 0, z);
                plane.rotation.set(0.0, angle ,0.0);
                plane.userData = { URL: '/photos/' + 0 };
                this.group.add(plane);
                this.planeArray.push(plane);
            }
            this.group.position.set( 0.0, 1.0, RADIUS);
            // 板ポリゴンをシーンに追加
            this.scene.add(this.group);
            // this.scene.add(this.axesHelper);

            this.raycaster = new THREE.Raycaster();
        }


        handleMouseDown(event) {
            this.startMouseX = event.clientX;
            this.isDragging = true;
        }

        handleMouseMove(event) {
            if (this.isDragging) {
                const mouseX = event.clientX;
                let startMouseX = this.startMouseX
                const mouseDeltaX = mouseX - startMouseX;
                this.targetRotationY += mouseDeltaX * -0.00025; // 回転量は適宜調整してください
                startMouseX = mouseX;
            }

            //3dオブジェクトとマウスカーソルの位置を監視
            const x = event.clientX / window.innerWidth * 2.0 - 1.0;
            const y = event.clientY / window.innerHeight * 2.0 - 1.0;
            const v = new THREE.Vector2(x, -y);
            this.raycaster.setFromCamera(v, this.camera);
            const intersects = this.raycaster.intersectObjects(this.planeArray);
            if (intersects.length > 0) {
                document.body.style.cursor = 'pointer';
            } else {
                document.body.style.cursor = 'default';
            }
        }

        handleMouseUp(event) {
            this.endMouseX = event.clientX;
            if (this.startMouseX === this.endMouseX) {
                const x = event.clientX / window.innerWidth * 2 - 1;
                const y = event.clientY / window.innerHeight * 2 - 1;
                const v = new THREE.Vector2(x, -y);
                this.raycaster.setFromCamera(v, this.camera);
                const intersects = this.raycaster.intersectObjects(this.planeArray);
                if (intersects.length > 0) {
                    console.log(intersects[0].object.material);
                    if (intersects[0].object.userData.URL) {
                        barba.go(intersects[0].object.userData.URL);
                    }
                }
            }
            this.isDragging = false;
        }

        drug(group) {
            // イージング計算を実行
            const easingFactor = 0.1;
            const rotationDiff = this.targetRotationY - this.currentRotationY;
            if (Math.abs(rotationDiff) > 0.001) {
                this.currentRotationY += rotationDiff * easingFactor;
                group.rotation.y = this.currentRotationY;
            }
        }


        /**
         * 描画処理
         */
        render() {
            requestAnimationFrame(this.render);
            // this.controls.update();
            this.drug(this.group)
            this.renderer.render(this.scene, this.camera);
        }
    }
</script>
